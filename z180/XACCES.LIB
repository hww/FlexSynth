;**********************************************
; СВЯЗЬ С DSP
; Функция связи с дсп имеет следующие модули
;	XBIOS	вызов функции XBIOS
;	.IN	ввод в порт
;	.OUT	вывод в порт
;	.L
;**********************************************

CSLT	EQU	1	; слот связи карта связи

;COMAND	EQU	4000H	; регистр команд
;MA	EQU	4001H	; акумулятор
;MHL	EQU	4002H	; HL
;MDE	EQU	4004H	; DE
;MBC	EQU	4006H	; BC

;**********************************************
; вызов функции XBIOS
;**********************************************

XACCES:
	DI
	PUSH	AF
	IN	A,(0A8H)
	LD	(FSLT),A
	AND	0F3H		; X0XX
	OR	004H		; X1XX комуникационный слот
	OUT	(0A8H),A
	POP	AF
	
	LD	(MA),A
	LD	(MHL),HL
	LD	(MDE),DE
	LD	(MBC),BC	; передадим регистры

	EX	(SP),HL
	LD	A,(HL)
	LD	(COMAND),A	; дадим команду
	INC	HL
	EX	(SP),HL

	CALL	WAIT

	LD	A,(MA)
	LD	HL,(MHL)
	LD	DE,(MDE)
	LD	BC,(MBC)	; прочитаем регистры

	PUSH	AF
	LD	A,(FSLT)
	OUT	(0A8H),A	; востановим слот
	POP	AF
	EI
	RET

WAIT:
	LD	A,(COMAND)	; ожидание готовности
	AND	0FH
	RET	Z
	JR	WAIT

FSLT:	DB			; временное сохранение слота
	NOP